# 优雅重启和关闭

优雅重启、升级和关闭机制在发布 `Pingora` 服务器新版本时非常常用，以避免异常或超长的停机时间。

`Pingora` 优雅升级机制保证以下几点：
* 请求肯定会被处理，无论是由旧的服务器实例还是新的服务器实例。没有请求会在尝试连接到服务器端点时看到连接被拒绝。
* 在优雅期内可以完成的请求肯定不会被终止。

## 如何进行优雅升级
### 步骤 0
配置升级`Socket`。旧版和新版服务器需要就该`Socket`的路径达成一致。有关详情，请参阅配置手册。

### 步骤 1
使用 `--upgrade` CLI 选项启动新实例。新实例不会立即尝试监听服务端点。它将尝试从旧实例那里获取监听`Socket`。

### 步骤 2
向旧实例发送 SIGQUIT 信号。旧实例将开始将监听`Socket`转移给新实例。

一旦步骤 2 成功，新实例将立即开始处理新的传入连接。与此同时，旧实例将进入优雅关闭模式。它会等待一段时间（给新实例预留时间初始化和处理流量），之后将不再接受任何新连接。
