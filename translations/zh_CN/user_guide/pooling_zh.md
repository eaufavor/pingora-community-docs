# 连接池和复用

当对 `Peer`（上游服务器）的请求结束时，与该对等方的连接将保持活动状态，并添加到连接池中，以供后续请求 _复用_。这一过程在没有任何特殊配置的情况下自动发生。

复用已建立的连接的请求避免了建立新连接的延迟和计算成本，提高了 `Pingora` 服务器的整体性能和可伸缩性。

## 相同的 `Peer`
只有与完全相同的 `Peer` 的连接才可以被请求复用。出于正确性和安全性的考虑，当且仅当所有以下属性都相同时，两个 `Peer` 才相同：
* IP:port
* 协议
* SNI
* 客户端证书
* 验证证书
* 验证主机名
* 替代 CN
* 代理设置

## 禁用连接池
要禁用与指定 `Peer` 的连接池和复用，只需将所有使用该 `Peer` 的请求的 `idle_timeout` 设置为 0 秒。

## 失败
如果请求过程中发生异常，则认为连接不可复用。
